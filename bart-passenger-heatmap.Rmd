---
title: "BART Passenger Heatmap"
author: "Justin Perona"
date: "2019-03-20"
output: html_document
runtime: shiny
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Introduction

My final project for ECI 254 was to create a heatmap of passengers that traveled through the San Francisco Bay Area Rapid Transit (BART) system.

### Motivation

### Previous Work

### Changes from Presentation

### Objective

My objective was to create a responsive Shiny app.

## Methodology

There are two major portions to this app:

1. Parsing through the input data.
2. Displaying the parsed data in Shiny.

### Parsing

#### Input Data

#### Parsing On Demand in R

#### Preparsing in Python

Dijkstra's / BFS

### Shiny App

#### User Interface (UI)

#### Reactives

#### Validation

## Results

The end result of my work is a working heatmap for the BART data that allows users to subset the input data by date and hour.

### Source Code

I have made all source code for this application available on GitHub in my repository [`jlperona/bart-passenger-heatmap`](https://github.com/jlperona/bart-passenger-heatmap).
The code in that repository is licensed under the MIT License, the same license which my prior work [`jlperona/bart-hourly-dataset-parser`](https://github.com/jlperona/bart-hourly-dataset-parser) was licensed under.

I'm a strong believer in the open-source movement.
Making this code available to all under an [open source license](https://opensource.org/licenses) is important to me.
Since I was the only one working on this data and project in the class at the time, I felt comfortable making the code open source before I turned this report in.
That being said, I hope nobody else attempts to pass this work off as their own.

### Running the Application

There are multiple mechanisms by which a user can run the heatmap.
I have listed some of them below.

#### Clone and Run Locally

Users who wish to run the heatmap can download the code and run it locally on their own machine.
One mechanism by which they can do this is via cloning my Git repository using the following command:

```
git clone https://github.com/jlperona/bart-passenger-heatmap.git
```

Once a user has cloned my repository, they can then build the application in RStudio.
This also allows users to make edits to the application, test them out, and potentially build their own similar application.

#### `shiny::runGitHub()`

Another mechanism to run the heatmap locally is provided by a function in the Shiny package.
If the application code is hosted on GitHub, Shiny makes it very easy to launch an application via the [`runGitHub()`](https://www.rdocumentation.org/packages/shiny/versions/0.9.0/topics/runGitHub) function.
It will download and launch Shiny applications that are hosted in a GitHub repository.
If a user wanted to run my application using this function, for instance, the following line of code would do so:

```{r echo=TRUE,eval=FALSE}
shiny::runGitHub("bart-passenger-heatmap", "jlperona")
```

The code above cannot be executed in a RMarkdown document and will give an error if attempted.
It is shown here for informative purposes.

#### *shinyapps.io*

Shiny apps are web apps and thus were meant to be hosted online.
I could have hosted this on a personal website, but I lack a server and the funds to maintain said server.
However, I found out that Shiny apps can be hosted on [*shinyapps.io*](https://www.shinyapps.io/), a website made by the creators of RStudio.

I have hosted my application on *shinyapps.io* at https://jlperona.shinyapps.io/bart-passenger-heatmap/.
This is how I demonstrated the app in my presentation.
However, *shinyapps.io* has tiered pricing depending on usage, limiting the number of hours an app can be run per month.
I am using the free tier, which means that I have a very limited amount of hours.
The link above may not work depending on whether I have exhausted my allotment for a given month.

#### Embedded in RMarkdown

It is possible to embed Shiny applications in RMarkdown, as I've done below.
You can either define the entire application inline using the [`shinyApp()`](https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html) function, or include the app in another directory using the [`shinyAppDir()`](https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html) function.
Since my app is split across multiple files and pulls from other data files, I have opted for the latter function.
In addition, you have to modify the YAML at the top of the document to tell RMarkdown that Shiny content is being included.
At the top of this RMarkdown document, I have added the following line:

```
runtime: shiny
```

The code below is shown for informative purposes.
Unfortunately, the limited width of a RMarkdown document messes up the UI of my application.
Note that in order to embed the app, I have had to include the entire set of application files with my submission.
The code below will not run unless the application files are included with this RMarkdown document.

```{r echo=TRUE}
# code courtesy of R Markdown: The Definitive Guide by Xie, Allaire, and Grolemund
# https://bookdown.org/yihui/rmarkdown/shiny-embedded.html
shinyAppDir(".",
            options = list(width = "100%",
                           height = 1080)
)
```

## Conclusion

I accomplished the objective I set out to achieve at the beginning of this project: a fully-functional and robust Shiny app that shows a heatmap of the BART system using BART's own data.
I also was able to take an idea I've had in the back of my mind ever since I took MAE 253 in Spring Quarter 2018 and bring it to life.
I'm quite happy with the result and my growth as an R programmer in this class.

### Methods for Improvement

The biggest flaw in this app right now is the UI layout.
I am not a UI or user experience (UX) expert, but I think that the UI can definitely be improved.
However, to my understanding, to do so in Shiny requires Cascading Style Sheets (CSS) experience, which I don't have.

Another "flaw" (which I would consider a difference in opinion) is the layout of the map.
I wanted to see the BART network overlaid on a real map.
However, this means that some of the edges are much larger than the others.
For example, the edges between the San Francisco stations are very difficult to see when the app is initially started.
You have to zoom in in order to see their colors.
A "better" heatmap would make it easier to see all the edges at once, which means that the stations would be evenly spaced.
Due to the setup of this app, it would be relatively easy to create a different heatmap by simply changing the station GIS data.
Since it's open source, anybody could take this as a base and create it, if they'd like to.

### Future Work

There are a couple of ways that I can think of to improve this app at the moment.
All of these should be possible with my skill set.

* Instead of calculating the sum of the number of passengers on an edge, show other summary statistics, such as the mean or median.
* Other visualization types, such as a circular [Sankey diagram](https://developers.google.com/chart/interactive/docs/gallery/sankey) that shows passengers' final destinations from a given source station.

I have another idea for future work, which isn't related to improving my app.
I will admit that it was somewhat difficult to get started with Shiny.
[This blog post on DataScience.com](https://www.datascience.com/blog/beginners-guide-to-shiny-and-leaflet-for-interactive-mapping) was the most helpful thing for getting me off the ground, but I was doing some things differently than them, which complicated matters.
That being said, I spent most of my time attempting to figure out a few more advanced pieces of Shiny, such as reactives and validating user input.
In contrast, I was able to get other things, like the preparser, done relatively quickly.
I do think that the Shiny documentation could be better for certain topics, like the ones I've mentioned above.
That is certainly an area for future work.
